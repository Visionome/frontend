import{c as G,r as m,j as e,B as y,L,u as I,C as _,a as C,b as B,d as k,e as R,f as P}from"./index-BSjY9pCh.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O=G("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F=G("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=G("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M=G("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=G("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),$="ATGGATTTATCTGCTCTTCGCGTTGAAGAAGTACAAAATGTCATTAATGCTATGCAGAAAATCTTAGAGTGTCCCATCTGTCTGGAGTTGATCAAGGAACCTGTCTCCACAAAGTGTGACCACATATTTTGCAAATTTTGCATGCTGAAACTTCTCAACCAGAAGAAAGGGCCTTCACAGTGTCCTTTATGTAAGAATGATATAACCAAAAGGAGCCTACAAGAAAGTACGAGATTTAGTCAACTTGTTGAAGAGCTATTGAAAATCATTTGTGCTTTTCAGCTTGACACAGGTTTGGAGTATGCAAACAGCTATAATTTTGCAAAAAAGGAAAATAACTCTCCTGAACATCTAAAAGATGAAGTTTCTATCATCCAAAGTATGGGCTACAGAAACCGTGCCAAAAGACTTCTACAGAGTGAACCCGAAAATCCTTCCTTG";function q({sequence:a,onSequenceChange:t,onRun:n,onClear:s,isLoading:r}){const l=m.useRef(null);function o(c){var A;const x=(A=c.target.files)==null?void 0:A[0];if(!x)return;const u=new FileReader;u.onload=g=>{var p;const T=(p=g.target)==null?void 0:p.result;if(typeof T=="string"){const f=T.split(`
`).filter(d=>!d.startsWith(">"));t(f.join("").trim())}},u.readAsText(x),c.target.value=""}return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-medium",children:"DNA Sequence"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(y,{variant:"ghost",size:"sm",onClick:()=>t($),className:"text-xs",children:[e.jsx(F,{className:"mr-1 h-3 w-3"}),"Example"]}),e.jsxs(y,{variant:"ghost",size:"sm",onClick:()=>{var c;return(c=l.current)==null?void 0:c.click()},children:[e.jsx(U,{className:"mr-1 h-3 w-3"}),"Upload"]}),e.jsx("input",{ref:l,type:"file",accept:".fasta,.fa,.txt",className:"hidden",onChange:o})]})]}),e.jsx("textarea",{value:a,onChange:c=>t(c.target.value),placeholder:"Paste a DNA sequence here (ATCG)...",rows:6,className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm font-mono ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 resize-y"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(y,{onClick:n,disabled:!a.trim()||r,children:[r?e.jsx(L,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(H,{className:"mr-2 h-4 w-4"}),r?"Running...":"Run BLAST"]}),e.jsxs(y,{variant:"outline",onClick:s,disabled:r,children:[e.jsx(M,{className:"mr-2 h-4 w-4"}),"Clear"]})]})]})}function z({matches:a,metadata:t}){const n=I();return a.length===0?null:e.jsxs("div",{className:"space-y-4",children:[t&&e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsx(_,{className:"flex-1 min-w-[140px]",children:e.jsxs(C,{className:"p-4 text-center",children:[e.jsx("p",{className:"text-2xl font-bold",children:t.total_hits}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Hits"})]})}),e.jsx(_,{className:"flex-1 min-w-[140px]",children:e.jsxs(C,{className:"p-4 text-center",children:[e.jsx("p",{className:"text-2xl font-bold",children:t.best_gene_symbol}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Best Match"})]})}),e.jsx(_,{className:"flex-1 min-w-[140px]",children:e.jsxs(C,{className:"p-4 text-center",children:[e.jsx("p",{className:"text-2xl font-bold",children:t.best_score}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Best Score"})]})}),e.jsx(_,{className:"flex-1 min-w-[140px]",children:e.jsxs(C,{className:"p-4 text-center",children:[e.jsx("p",{className:"text-2xl font-bold",children:t.best_evalue.toExponential(2)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Best E-Value"})]})})]}),e.jsxs(_,{children:[e.jsx(B,{className:"pb-3",children:e.jsxs(k,{className:"text-base",children:["Results ",e.jsx(R,{variant:"secondary",className:"ml-2",children:a.length})]})}),e.jsx(C,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"pb-2 pr-4 text-left font-medium text-muted-foreground",children:"Gene"}),e.jsx("th",{className:"pb-2 pr-4 text-right font-medium text-muted-foreground",children:"Hits"}),e.jsx("th",{className:"pb-2 pr-4 text-right font-medium text-muted-foreground",children:"Score"}),e.jsx("th",{className:"pb-2 pr-4 text-right font-medium text-muted-foreground",children:"E-Value"}),e.jsx("th",{className:"pb-2 pr-4 text-right font-medium text-muted-foreground",children:"Align Len"}),e.jsx("th",{className:"pb-2 pr-4 text-right font-medium text-muted-foreground",children:"Start"}),e.jsx("th",{className:"pb-2 text-right font-medium text-muted-foreground",children:"End"})]})}),e.jsx("tbody",{children:a.map((s,r)=>e.jsxs("tr",{className:"border-b last:border-0 hover:bg-muted/50",children:[e.jsx("td",{className:"py-2 pr-4",children:e.jsx("button",{className:"font-medium text-primary hover:underline",onClick:()=>n(`/?gene=${s.gene_symbol}`),children:s.gene_symbol})}),e.jsx("td",{className:"py-2 pr-4 text-right tabular-nums",children:s.num_hits}),e.jsx("td",{className:"py-2 pr-4 text-right tabular-nums",children:s.best_score}),e.jsx("td",{className:"py-2 pr-4 text-right tabular-nums",children:s.best_evalue.toExponential(2)}),e.jsx("td",{className:"py-2 pr-4 text-right tabular-nums",children:s.align_length}),e.jsx("td",{className:"py-2 pr-4 text-right tabular-nums",children:s.sbjct_start.toLocaleString()}),e.jsx("td",{className:"py-2 text-right tabular-nums",children:s.sbjct_end.toLocaleString()})]},r))})]})})})]})]})}function V(a){return new Date(a).toLocaleDateString(void 0,{month:"short",day:"numeric",hour:"numeric",minute:"2-digit"})}function J({searches:a,onSelect:t,onDelete:n}){return a.length===0?null:e.jsxs(_,{children:[e.jsx(B,{className:"pb-3",children:e.jsxs(k,{className:"flex items-center gap-2 text-base",children:[e.jsx(O,{className:"h-4 w-4"}),"Previous Searches"]})}),e.jsx(C,{className:"space-y-1",children:a.map(s=>{var r;return e.jsxs("div",{className:"flex items-center justify-between rounded-md px-3 py-2 hover:bg-muted/50 cursor-pointer group",onClick:()=>t(s),children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"truncate font-mono text-sm",children:s.label}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[V(s.timestamp)," · ",s.matches.length," gene",s.matches.length!==1?"s":"",((r=s.metadata)==null?void 0:r.best_gene_symbol)&&` · Best: ${s.metadata.best_gene_symbol}`]})]}),e.jsx(y,{variant:"ghost",size:"sm",className:"ml-2 opacity-0 group-hover:opacity-100 h-7 w-7 p-0",onClick:l=>{l.stopPropagation(),n(s.id)},children:e.jsx(M,{className:"h-3.5 w-3.5 text-muted-foreground"})})]},s.id)})})]})}const Y=[{gene_symbol:"SAMD11",num_hits:42,best_score:1020,best_evalue:186617e-46,align_length:5e3,sbjct_start:2e3,sbjct_end:5e3},{gene_symbol:"ACBD11",num_hits:42,best_score:1020,best_evalue:186617e-46,align_length:5e3,sbjct_start:2e3,sbjct_end:5e3},{gene_symbol:"SAMD11",num_hits:42,best_score:1020,best_evalue:186617e-46,align_length:5e3,sbjct_start:2e3,sbjct_end:5e3},{gene_symbol:"ACBD11",num_hits:42,best_score:1020,best_evalue:186617e-46,align_length:5e3,sbjct_start:2e3,sbjct_end:5e3},{gene_symbol:"SAMD11",num_hits:42,best_score:1020,best_evalue:186617e-46,align_length:5e3,sbjct_start:2e3,sbjct_end:5e3},{gene_symbol:"ACBD11",num_hits:42,best_score:1020,best_evalue:186617e-46,align_length:5e3,sbjct_start:2e3,sbjct_end:5e3},{gene_symbol:"SAMD11",num_hits:42,best_score:1020,best_evalue:186617e-46,align_length:5e3,sbjct_start:2e3,sbjct_end:5e3},{gene_symbol:"ACBD11",num_hits:42,best_score:1020,best_evalue:186617e-46,align_length:5e3,sbjct_start:2e3,sbjct_end:5e3},{gene_symbol:"SAMD11",num_hits:42,best_score:1020,best_evalue:186617e-46,align_length:5e3,sbjct_start:2e3,sbjct_end:5e3},{gene_symbol:"ACBD11",num_hits:42,best_score:1020,best_evalue:186617e-46,align_length:5e3,sbjct_start:2e3,sbjct_end:5e3},{gene_symbol:"ACBD11",num_hits:42,best_score:1020,best_evalue:186617e-46,align_length:5e3,sbjct_start:2e3,sbjct_end:5e3}],X={matches:Y},D="https://blast.ncbi.nlm.nih.gov/blast/Blast.cgi",Z=5e3,K=18e4;async function Q(a){const t=new URLSearchParams({CMD:"Put",PROGRAM:"blastn",DATABASE:"nt",QUERY:a}),n=await fetch(D,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:t.toString()});if(!n.ok)throw new Error(`NCBI BLAST submit failed: ${n.status}`);const r=(await n.text()).match(/RID\s*=\s*(\S+)/);if(!r)throw new Error("Could not parse RID from NCBI response");return r[1]}async function W(a){const t=Date.now();for(;Date.now()-t<K;){await new Promise(l=>setTimeout(l,Z));const n=`${D}?CMD=Get&FORMAT_OBJECT=SearchInfo&RID=${a}`,r=await(await fetch(n)).text();if(r.includes("Status=READY"))return;if(r.includes("Status=FAILED"))throw new Error("NCBI BLAST job failed");if(r.includes("Status=UNKNOWN"))throw new Error("NCBI BLAST RID expired or unknown")}throw new Error("NCBI BLAST timed out")}async function ee(a){var x,u,A,g,T,p,j,f,d;const t=`${D}?CMD=Get&FORMAT_TYPE=JSON2_S&RID=${a}`,n=await fetch(t);if(!n.ok)throw new Error(`NCBI BLAST results fetch failed: ${n.status}`);const s=await n.json(),r=((T=(g=(A=(u=(x=s==null?void 0:s.BlastOutput2)==null?void 0:x[0])==null?void 0:u.report)==null?void 0:A.results)==null?void 0:g.search)==null?void 0:T.hits)??[],l=new Map;for(const i of r){const S=(((j=(p=i.description)==null?void 0:p[0])==null?void 0:j.title)??"").match(/\(([A-Z][A-Z0-9]{1,10})\)/),w=(S==null?void 0:S[1])??((d=(f=i.description)==null?void 0:f[0])==null?void 0:d.accession)??"Unknown";for(const h of i.hsps){const b=l.get(w);b?(b.num_hits+=1,h.bit_score>b.best_score&&(b.best_score=h.bit_score),h.evalue<b.best_evalue&&(b.best_evalue=h.evalue),h.align_len>b.align_length&&(b.align_length=h.align_len)):l.set(w,{gene_symbol:w,num_hits:1,best_score:h.bit_score,best_evalue:h.evalue,align_length:h.align_len,sbjct_start:h.hit_from,sbjct_end:h.hit_to})}}const o=Array.from(l.values()).sort((i,v)=>v.best_score-i.best_score),c=o.length>0?{total_hits:o.reduce((i,v)=>i+v.num_hits,0),best_score:o[0].best_score,best_evalue:o[0].best_evalue,best_gene_symbol:o[0].gene_symbol,longest_alignment:Math.max(...o.map(i=>i.align_length))}:void 0;return{matches:o,metadata:c}}async function te(a){try{const t=await Q(a);return await W(t),await ee(t)}catch(t){return console.warn("NCBI BLAST unavailable, using mock data:",t.message),await new Promise(n=>setTimeout(n,500)),X}}const E="visionome:blast-cache",se=20;function ae(){return Date.now().toString(36)+Math.random().toString(36).slice(2,7)}function ne(a){const t=a.replace(/\s+/g,""),n=t.slice(0,20);return t.length>20?`${n}…`:n}function N(){try{const a=localStorage.getItem(E);return a?JSON.parse(a):[]}catch{return[]}}function re(a,t,n){const s={id:ae(),label:ne(a),timestamp:Date.now(),matches:t,metadata:n},r=N(),l=[s,...r].slice(0,se);return localStorage.setItem(E,JSON.stringify(l)),s}function le(a){const t=N().filter(n=>n.id!==a);localStorage.setItem(E,JSON.stringify(t))}function ce(){const[a,t]=m.useState(""),[n,s]=m.useState([]),[r,l]=m.useState(null),[o,c]=m.useState(!1),[x,u]=m.useState(null),[A,g]=m.useState(N),T=m.useCallback(async d=>{if(d.trim()){c(!0),u(null);try{const i=await te(d);s(i.matches),l(i.metadata??null),re(d,i.matches,i.metadata??null),g(N())}catch{u("BLAST search failed. Please try again."),s([]),l(null)}finally{c(!1)}}},[]),p=m.useCallback(d=>{t(""),s(d.matches),l(d.metadata),u(null)},[]),j=m.useCallback(d=>{le(d),g(N())},[]),f=m.useCallback(()=>{t(""),s([]),l(null),u(null)},[]);return{sequence:a,setSequence:t,matches:n,metadata:r,isLoading:o,error:x,runSearch:T,clear:f,cachedSearches:A,loadCached:p,removeFromCache:j}}function oe(){const{sequence:a,setSequence:t,matches:n,metadata:s,isLoading:r,error:l,runSearch:o,clear:c,cachedSearches:x,loadCached:u,removeFromCache:A}=ce();return e.jsxs("div",{className:"mx-auto max-w-4xl space-y-6 p-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Sequence Analyzer"}),e.jsx("p",{className:"text-muted-foreground",children:"Submit a DNA sequence to run a BLAST search against the human genome reference database."})]}),e.jsxs(_,{children:[e.jsxs(B,{children:[e.jsx(k,{className:"text-base",children:"BLAST Search"}),e.jsx(P,{children:"Paste a DNA sequence or upload a FASTA file to find matching genes."})]}),e.jsx(C,{children:e.jsx(q,{sequence:a,onSequenceChange:t,onRun:()=>o(a),onClear:c,isLoading:r})})]}),l&&e.jsx("div",{className:"rounded-md border border-destructive/50 bg-destructive/10 p-4 text-sm text-destructive",children:l}),e.jsx(z,{matches:n,metadata:s}),e.jsx(J,{searches:x,onSelect:u,onDelete:A})]})}export{oe as AnalyzerPage};
